# 🗄️ C#單元五：SQL Server 資料庫基礎

---

## 🎯 單元目標

-✅ 了解資料庫的基本概念與架構
-✅ 學會安裝 SQL Server 與 SSMS（SQL Server Management Studio）
-✅ 理解資料庫伺服器、資料庫、資料表、欄位的層級關係
-✅ 能夠使用 SSMS 建立資料庫與資料表
-✅ 掌握建立通訊錄資料表的實作方法

---

## 💻 安裝 SQL Server 與 SSMS

本節將詳細說明如何安裝 SQL Server 2019 Express 和 SSMS（SQL Server Management Studio），並完成必要的連線設定。

---

### 📥 步驟一：下載並安裝 SQL Server 2019 Express

#### 1.1 下載安裝程式

1. 前往 Google 搜尋 `sql server 2019 express`
   ![1763193907440](image/Course5/1763193907440.png)
2. 選取語言後，按 `下載` 並開啟安裝程式
   ![1763193974818](image/Course5/1763193974818.png)

#### 1.2 執行安裝

1. 開啟安裝程式後，選擇中間的 `自訂` 安裝類型
   ![1763194047593](image/Course5/1763194047593.png)
2. 確認要安裝的語言和下載路徑後，點擊 `安裝`
   ![1763194073505](image/Course5/1763194073505.png)
3. 等待下載主程式完成
   ![1763194094359](image/Course5/1763194094359.png)
4. 點選「新增 SQL Server 獨立安裝」
   ![1763194916684](image/Course5/1763194916684.png)

#### 1.3 功能選擇（重要）

⚠️ **請特別注意**：需要將以下功能取消勾選或確認沒有勾選，因為用不到且會影響安裝進度

- **機器學習服務和語言延伸模組**
  - R
  - Python
  - Java
- **外部資料的 PolyBase 查詢服務**

![1763195299083](image/Course5/1763195299083.png)

#### 1.4 執行個體設定

- 執行個體名稱可以不用改，直接點擊「下一步」即可
  ![1763195409112](image/Course5/1763195409112.png)

#### 1.5 伺服器設定

1. 請選擇「混合模式」驗證
2. 將目前使用者加入管理員
3. 設定 SA 帳號密碼：
   - ⚠️ **教學用途**：建議輸入 `my@PWD`
   - ⚠️ **實務環境**：請使用更強的安全性密碼

> 💡 **說明**：選擇混合模式後，可以用 Windows 驗證或 SQL Server 驗證登入 SQL Server

![1763195726844](image/Course5/1763195726844.png)

#### 1.6 完成安裝

靜待安裝完成
![1763206899246](image/Course5/1763206899246.png)

---

### 🔧 步驟二：IP 位址連線設定

為了讓 SQL Server 可以透過網路連線，需要進行以下設定：

#### 2.1 開啟 SQL Server 設定管理員

1. 打開「SQL Server 2019 設定管理員」
   ![1763208607042](image/Course5/1763208607042.png)

#### 2.2 啟用 TCP/IP 通訊協定

1. 展開「SQL Server 網路組態」→「SQLEXPRESS 的通訊協定」
2. 將「TCP/IP」改為「啟用」
   ![1763208910244](image/Course5/1763208910244.png)

#### 2.3 設定 TCP Port

1. 雙擊「TCP/IP」開啟屬性視窗
2. 切換到「IP 位址」分頁
3. 拉到最下面，將「IPALL」的「TCP Port」設定為 `1433`
4. 按下「確定」
   ![1763209007388](image/Course5/1763209007388.png)

#### 2.4 重啟 SQL Server 服務

重啟服務以套用設定
![1763210756786](image/Course5/1763210756786.png)

---

### 🔥 步驟三：防火牆設定

為了允許外部連線，需要在 Windows 防火牆中開啟 SQL Server 的連接埠。

#### 3.1 開啟防火牆進階設定

1. 開啟「控制台」
   ![1763209151574](image/Course5/1763209151574.png)
2. 開啟「Windows Defender 防火牆」→「進階設定」  或直接執行 `wf.msc`
   ![1763209277044](image/Course5/1763209277044.png)
   ![1763209325698](image/Course5/1763209325698.png)

#### 3.2 新增輸入規則

1. 點選「輸入規則」→「新增規則」
   ![1763209388783](image/Course5/1763209388783.png)
2. 選擇「連接埠」→「下一步」
   ![1763209425098](image/Course5/1763209425098.png)
3. 選擇「TCP」，並在「特定本機連接埠」輸入 `1433`→「下一步」
   ![1763209467479](image/Course5/1763209467479.png)
4. 選擇「允許連線」→「下一步」
5. 勾選所有設定檔（網域、私人、公用）→「下一步」
6. 設定規則名稱（例如：SQL Server 1433）→「完成」
   ![1763209539378](image/Course5/1763209539378.png)

---

### 📥 步驟四：下載並安裝 SSMS

SSMS（SQL Server Management Studio）是用來管理 SQL Server 的圖形化工具。

#### 4.1 下載 SSMS

請前往以下連結下載 SSMS：

- **官方下載連結**：[https://go.microsoft.com/fwlink/?linkid=2257624&amp;clcid=0x404](https://go.microsoft.com/fwlink/?linkid=2257624&clcid=0x404)

![1763206930524](image/Course5/1763206930524.png)

#### 4.2 執行安裝

1. 執行下載的安裝程式
2. 按照指示完成安裝
   ![1763206992552](image/Course5/1763206992552.png)
   ![1763211351090](image/Course5/1763211351090.png)

---

### 🔌 步驟五：連接到 SQL Server

#### 5.1 開啟 SSMS

從「開始」選單開啟 SSMS
![1763218176947](image/Course5/1763218176947.png)

#### 5.2 設定連線資訊

在「連接到伺服器」視窗中，輸入以下資訊：

- **伺服器類型**：資料庫引擎
- **伺服器名稱**：`localhost` 或 `電腦名稱\SQLEXPRESS`
- **驗證**：SQL Server 驗證
- **登入**：`sa`
- **密碼**：`my@PWD`（或您設定的密碼）

![1763218681505](image/Course5/1763218681505.png)

#### 5.3 驗證連線成功

點擊「連接」後，如果看到「物件總管」視窗，表示連線成功！
![1763218772665](image/Course5/1763218772665.png)

> ✅ **連線成功標誌**：左側「物件總管」會顯示您的 SQL Server 實例，可以展開查看資料庫、安全性等節點。

---

## 📚 資料庫基本概念

### 🏗️ 資料庫架構層級關係

資料庫系統採用階層式架構，從大到小的層級關係如下：

```
資料庫伺服器 (Database Server)
    └── 資料庫 (Database)
        └── 資料表 (Table)
            └── 欄位 (Column/Field)
                資料列 (Row/Record)
```

#### 🔹 資料庫伺服器 (Database Server)

- **定義**：提供資料庫服務的軟體系統，負責管理、儲存和處理資料
- **功能**：接收客戶端的請求、執行 SQL 指令、管理資料庫的存取權限
- **範例**：SQL Server、MySQL、Oracle 等

#### 🔹 資料庫 (Database)

- **定義**：在伺服器內建立的邏輯容器，用來組織和管理相關的資料表
- **功能**：將不同用途的資料表分門別類存放
- **範例**：`DB_TEST`（通訊錄資料庫）、`SchoolDB`（學校資料庫）

#### 🔹 資料表 (Table)

- **定義**：資料庫中儲存資料的結構化容器，由欄位和資料列組成
- **功能**：儲存特定類型的資料，例如：通訊錄資料表、學生資料表
- **範例**：`AddressBookTbl`（通訊錄表）、`ProductTbl`（學生表）

#### 🔹 欄位 (Column/Field)

- **定義**：資料表中的垂直欄，定義資料的類型和屬性
- **功能**：儲存特定類型的資料，例如：姓名、電話、地址
- **範例**：`chName`（姓名欄位）、`chTel`（電話欄位）、`chAddress`（地址欄位）

#### 🔹 資料列 (Row/Record)

- **定義**：資料表中的水平列，代表一筆完整的資料記錄
- **功能**：儲存一筆完整的資料
- **範例**：一筆通訊錄資料（包含編號、姓名、生日、性別、電話、地址）

### 📊 實際範例說明

假設我們要建立一個「通訊錄管理系統」：

```
SQL Server 伺服器
    └── DB_TEST（通訊錄資料庫）
        └── AddressBookTbl（通訊錄資料表）
            ├── chID（身份證字號欄位，char(10)）
            ├── chName（姓名欄位，char(10)）
            ├── chSex（性別欄位，char(1)）
            ├── chBirthday（生日欄位，char(7)）
            ├── chTel（電話欄位，char(20)）
            └── chAddress（地址欄位，char(60)）
```

**資料表結構說明**：

| 欄位名稱     | 資料型別   | 說明                  |
| ------------ | ---------- | --------------------- |
| `chID`       | `char(10)` | 身份證字號（主鍵）    |
| `chName`     | `char(10)` | 姓名                  |
| `chSex`      | `char(1)`  | 性別（1/0）           |
| `chBirthday` | `char(7)`  | 生日（民國年YYYMMDD） |
| `chTel`      | `char(20)` | 電話                  |
| `chAddress`  | `char(60)` | 地址                  |

**資料列範例**：

| chID       | chName | chSex | chBirthday | chTel       | chAddress    |
| ---------- | ------ | ----- | ---------- | ----------- | ------------ |
| A123456789 | 張三   | 1     | 0870106    | 0912-345678 | 台北市信義區 |
| B234567890 | 李四   | 0     | 1141116    | 0923-456789 | 新北市板橋區 |

---

## 🏗️ 建立資料庫

### 📝 步驟一：建立新資料庫

1. 在「物件總管」中，右鍵點擊「資料庫」
2. 選擇「新增資料庫」
3. 在「資料庫名稱」欄位輸入：`DB_TEST`
4. 點擊「確定」按鈕
   ![1763220098777](image/Course5/1763220098777.png)
   ![1763220154407](image/Course5/1763220154407.png)

### ✅ 驗證資料庫建立成功

在「物件總管」中，展開「資料庫」節點，您應該會看到 `DB_TEST` 資料庫。

---

## 📋 建立通訊錄資料表

### 🎯 資料表設計

我們要建立一個「通訊錄」資料表，用來儲存聯絡人資訊。

#### 欄位規劃

| 欄位名稱     | 資料型別   | 說明                  | 是否允許 NULL |
| ------------ | ---------- | --------------------- | ------------- |
| `chID`       | `char(10)` | 身份證字號（主鍵）    | ❌ 否          |
| `chName`     | `char(10)` | 姓名                  | ❌ 否          |
| `chSex`      | `char(1)`  | 性別（1/0）           | ✅ 是          |
| `chBirthday` | `char(7)`  | 生日（民國年YYYMMDD） | ✅ 是          |
| `chTel`      | `char(20)` | 電話                  | ✅ 是          |
| `chAddress`  | `char(60)` | 地址                  | ✅ 是          |

### 📝 步驟二：建立資料表（使用 SSMS 圖形介面）

1. 在「物件總管」中，展開 `DB_TEST` 資料庫
2. 右鍵點擊「資料表」
3. 選擇「新增」→「資料表」
4. 在資料表設計視窗中，依序新增以下欄位：

   **欄位 1：chID**

   - 欄位名稱：`chID`
   - 資料型別：`char(10)`
   - 取消勾選「允許 Null」
   - 右鍵點擊該欄位，選擇「設定主索引鍵」

   **欄位 2：chName**

   - 欄位名稱：`chName`
   - 資料型別：`char(10)`
   - 取消勾選「允許 Null」

   **欄位 3：chSex**

   - 欄位名稱：`chSex`
   - 資料型別：`char(1)`
   - 勾選「允許 Null」

   **欄位 4：chBirthday**

   - 欄位名稱：`chBirthday`
   - 資料型別：`char(7)`
   - 勾選「允許 Null」

   **欄位 5：chTel**

   - 欄位名稱：`chTel`
   - 資料型別：`char(20)`
   - 勾選「允許 Null」

   **欄位 6：chAddress**

   - 欄位名稱：`chAddress`
   - 資料型別：`char(60)`
   - 勾選「允許 Null」
5. 點擊工具列上的「儲存」按鈕（或按 `Ctrl + S`）
6. 輸入資料表名稱：`AddressBookTbl`
7. 點擊「確定」按鈕
   ![1763220243657](image/Course5/1763220243657.png)
   ![1763220491640](image/Course5/1763220491640.png)
   ![1763220525454](image/Course5/1763220525454.png)

### ✅ 驗證資料表建立成功

1. 在「物件總管」中，展開 `DB_TEST` 資料庫
2. 展開「資料表」節點
3. 您應該會看到 `dbo.AddressBookTbl` 資料表
4. 展開 `dbo.AddressBookTbl`，可以看到「資料行」節點，裡面包含我們剛才建立的欄位

### 📝 步驟四：新增測試資料

1. 在「物件總管」中，右鍵點擊 `dbo.AddressBookTbl` 資料表
2. 選擇「編輯前 200 個資料列」
3. 在資料編輯視窗中，新增以下測試資料：

| chID       | chName | chSex | chBirthday | chTel       | chAddress    |
| ---------- | ------ | ----- | ---------- | ----------- | ------------ |
| A123456789 | 張三   | 1     | 0870106    | 0912-345678 | 台北市信義區 |
| B234567890 | 李四   | 0     | 1141116    | 0923-456789 | 新北市板橋區 |
| C345678901 | 王五   | 1     | 0920301    | 0934-567890 | 桃園市中壢區 |

4. 輸入完成後，按 `Enter` 或點擊其他列，資料會自動儲存
   ![1763222627042](image/Course5/1763222627042.png)
   ![1763222854426](image/Course5/1763222854426.png)

---

## 📖 SQL 語法說明

### 🔹 CREATE TABLE 語法

```sql
CREATE TABLE 資料表名稱
(
    欄位名稱1 資料型別 [限制條件],
    欄位名稱2 資料型別 [限制條件],
    ...
);
```

### 🔹 常用資料型別

| 資料型別       | 說明                       | 範例                                               |
| -------------- | -------------------------- | -------------------------------------------------- |
| `int`          | 整數                       | 1, 100, -50                                        |
| `nvarchar(n)`  | 可變長度字串（Unicode）    | `nvarchar(50)` 最多 50 個字元                      |
| `varchar(n)`   | 可變長度字串（非 Unicode） | `varchar(50)` 最多 50 個英文符號字元(或25個中文字) |
| `datetime`     | 日期時間                   | 2024-01-15 10:30:00                                |
| `decimal(p,s)` | 精確數值                   | `decimal(10,2)` 總共 10 位數，小數點後 2 位        |

### 🔹 常用限制條件

| 限制條件        | 說明                            | 範例                                    |
| --------------- | ------------------------------- | --------------------------------------- |
| `PRIMARY KEY`   | 主鍵（唯一識別）                | `ContactID int PRIMARY KEY`             |
| `IDENTITY(1,1)` | 自動遞增（從 1 開始，每次加 1） | `ContactID int IDENTITY(1,1)`           |
| `NOT NULL`      | 不允許空值                      | `Name nvarchar(50) NOT NULL`            |
| `NULL`          | 允許空值（預設）                | `Phone nvarchar(20) NULL`               |
| `DEFAULT 值`    | 預設值                          | `CreateDate datetime DEFAULT GETDATE()` |

---

## 🏠 課後作業：建立商品基本檔資料表

### 📋 作業要求

請建立一個「商品基本檔」資料表，用來儲存商品資訊。

### 🎯 資料表設計需求

#### 欄位規劃

| 欄位名稱          | 資料型別    | 說明             | 是否允許 NULL |
| ----------------- | ----------- | ---------------- | ------------- |
| `chProdNo`        | `char(7)`   | 商品編號（主鍵） | ❌ 否          |
| `chProdName`      | `char(100)` | 商品名稱         | ❌ 否          |
| `chUnit`          | `char(4)`   | 單位             | ✅ 是          |
| `rlStockQty`      | `real`      | 庫存數量         | ✅ 是          |
| `rlInpPrice`      | `real`      | 進貨價格         | ✅ 是          |
| `rlSellPrice`     | `real`      | 售價             | ✅ 是          |
| `chCreatDateTime` | `char(11)`  | 建立日期時間     | ✅ 是          |

### 📝 作業步驟

1. 在 `DB_TEST` 資料庫中（或建立新的資料庫），建立 `ProductTbl` 資料表
2. 使用 SSMS 圖形介面或 SQL 指令建立資料表
3. 新增至少 3 筆測試資料
4. 截圖或記錄您建立的資料表結構

### 💡 提示

- 商品編號（`chProdNo`）為主鍵，使用 `char(7)` 型別
- 商品名稱（`chProdName`）為必填欄位（NOT NULL）
- 庫存數量、進貨價格、售價使用 `real` 型別（浮點數）
- 建立日期時間（`chCreatDateTime`）使用 `char(11)` 型別

### ✅ 驗證清單

完成作業後，請確認：

- [ ] 資料表已成功建立
- [ ] 所有欄位都已正確設定
- [ ] 主鍵已設定為 `chProdNo`
- [ ] 已新增至少 3 筆測試資料
- [ ] 資料可以正常顯示

## 🎓 本週重點回顧

- ✅ 資料庫採用階層式架構：伺服器 → 資料庫 → 資料表 → 欄位 → 資料列
- ✅ SQL Server 是微軟的關聯式資料庫管理系統
- ✅ SSMS 是用來管理 SQL Server 的圖形化工具
- ✅ 使用 `CREATE TABLE` 指令可以建立資料表
- ✅ 主鍵（PRIMARY KEY）用來唯一識別每一筆資料
- ✅ `IDENTITY(1,1)` 可以讓欄位自動遞增
- ✅ `NOT NULL` 和 `NULL` 用來控制欄位是否允許空值
